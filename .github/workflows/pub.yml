name: Deploy to Amazon
on: 
  push:
    branches:
      - "GithubActions"
  
jobs:
  deploy:
    name: "Deploy to AWS"

    runs-on: ubuntu-latest

    steps:
     - name: Set up Python
       uses: actions/setup-python@v1
       with:
         python-version: '3.x'
     - name: Install dependencies
       run: python -m pip install --upgrade pip awsebcli
       
     - uses: actions/checkout@v2
       
     - name: Setup .NET Core
       uses: actions/setup-dotnet@v1
       with:
         dotnet-version: 3.1.100
     
     - name: Publish with .NET
       run: dotnet publish --configuration Release Shopkeeper/Shopkeeper/Shopkeeper.csproj -o publish
     
     - name: Create deployment package
       run: zip -j deploy.zip aws-windows-deployment-manifest.json publish/*
     
     - name: Deploy to EB
       run: |
          echo 'n' | eb init --region us-east-2 dota2quiz
          eb deploy
       env:
         AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
         AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
         AWS_DEFAULT_REGION: "us-east-2"

